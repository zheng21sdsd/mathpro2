<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathPro</title>
{#    <link rel="stylesheet" href="static/css/mindmap.css">#}
    <link rel="stylesheet" href="{{ url_for('static',filename='css/mindmap.css')}}">
    <script src="{{ url_for('static', filename='jquery/jquery.3.6.min.js') }}"></script>


    <style>
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="user-info">
            <img class="avatar-img" src="../../picture/avatar.png" alt="mind-map" onclick="openModal('avatar-modal')">
            <div class="username">MathPro</div>
        </div>
        <ul>
            <li data-content="这里是账号管理的内容">个人信息</li>
            <li data-content="这里是收藏夹的内容">收藏夹</li>
            <li data-content="这里是错题本的内容">错题本</li>
        </ul>
        <button class="logout-btn">退出登录</button>
    </div>

    <div class="container">
    <div class="top-nav">
        <a href="{{ url_for('qa.practicecheck') }}"><button class="button">训练场</button></a>
        <a href="{{ url_for('qa.ranking') }}"><button class="button">排行榜</button></a>
        <a href="{{ url_for('qa.mindmap') }}"><button class="button">思维导图</button></a>
        <a>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="请输入">
                <button class="search-button">搜索</button>
            </div>
            <div class="select-container">
                <div class="select-half">
                    <div class="text01">知识点</div>
                    <select class="select-box">
                        <option value="knowledge1">1</option>
                        <option value="knowledge2">2</option>
                        <option value="knowledge3">3</option>
                    </select>
                </div>
                <div class="select-half">
                    <div class="text01">难易程度</div>
                    <select class="select-box">
                        <option value="difficult1">1</option>
                        <option value="difficult2">2</option>
                        <option value="difficult3">3</option>
                        <option value="difficult4">4</option>
                        <option value="difficult5">5</option>
                    </select>
                </div>
            </div>
        </a>
    </div>
    <div class="back-button" onclick="goBack()"></div>

    <div class="map-container">
        <div class="map-half">
            <select class="map-box" id="map1" onchange="updateMap2Options()">
                <option value="数一">数学一</option>
                <option value="数二">数学二</option>
                <option value="数三">数学三</option>
            </select>
        </div>
        <div class="map-half">
            <select class="map-box" id="map2">
                <option value="高数">高数</option>
                <option value="线代">线代</option>
                <option value="概率">概率</option>
            </select>
        </div>
    </div>
{#    <div class="mindmap"><h1>思维导图</h1> <img src="..\\static\\mindmap\\数一概率论.png" alt="mind-map"></div>#}
    <div class="mindmap" style = "overflow: hidden">
        <h1>思维导图</h1>
    {#    {{ mindmap_infos.mindmap_path }}#}
    {#    scores|default('', true) }}#}

        <img src="..\\static\\mindmap\\数一概率论.png" alt="mind-map" style="width: 100%;height: 100%;">
    {#    <img src="|{{ mindmap_infos[0].mindmap_path }}" alt="mind-map" style="max-width: 100%; height: auto;">#}
    </div>
    </div>
{#    数二没有概率论选项#}
    <script>
        function updateMap2Options() {
            var map1 = document.getElementById('map1');
            var map2 = document.getElementById('map2');

            // 移除map2中所有选项
            while (map2.options.length > 0) {
                map2.remove(0);
            }

            // 根据map1的选择添加选项
            if (map1.value === "数二") {
                var options = [{'text': '高数', 'value': '高数'}, {'text': '概率', 'value': '概率'}];
            } else {
                var options = [{'text': '高数', 'value': '高数'}, {'text': '线代', 'value': '线代'}, {
                    'text': '概率',
                    'value': '概率'
                }];
            }

            // 为map2添加选项
            for (var i = 0; i < options.length; i++) {
            var  option = new Option(options[i].text, options[i].value);
                map2.options.add(option);
            }
        }

    </script>
    <script>
         var map1Select = $("#map1");
        var map2Select = $("#map2");
        function fetchImage() {
            var map1Value = map1Select.val();
            var map2Value = map2Select.val();
           {#// fomData1 = new FormData();#}
           {# //fomData1.append('map1Value', map1Value);#}
           {# //fomData1.append('map2Value', map2Value);#}

            // 使用AJAX向后端发送请求
            $.ajax({
                url: '/mindmap_image', // 后端接口URL
                type: 'GET', // 请求类型
                data: {
                    map1Value: map1Value,
                    map2Value: map2Value
                }, // 将选择的value作为参数发送
                success: function(response) {
                    // 假设响应是图片的URL

                    $('.mindmap img').attr('src', response.imageUrl); // 更新图片的src
                    console.log(response);
                },
                error: function(error) {
                    console.log(error);
                    // 错误处理
            }
        });
    }

    // 当任一下拉框的选项改变时，获取图片
    map1Select.change(fetchImage);
    map2Select.change(fetchImage);
    </script>

    <script>
        function goBack() {
          window.history.back(); // JavaScript方法返回上一页
        }
    </script>

    <div id="avatar-modal" class="modal">
        <div class="modal-content">
            <h2>Change Avatar</h2>
            <input type="file" accept="image/*"> 
            <button onclick="closeModal('avatar-modal')">Close</button>
        </div>
    </div>
    
    <script>
        // 显示模态框
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'block';
        }
        // 关闭模态框
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
        }
    </script>

    <script>
        const menuItems = document.querySelectorAll('.menu-item');
        const infoDisplay = document.querySelector('.info-area-content');
        const accountForm = document.querySelector('.account-form');
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                if (this.textContent === '账号管理') {
                    accountForm.style.display = 'block';
                } else {
                    accountForm.style.display = 'none';
                }
            });
        });
        const form = document.getElementById('accountForm');
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            // 处理表单提交的逻辑，可以使用 JavaScript 发送到后端进行处理
            // 这里只是示例，没有实际的后端交互
            alert('信息已更新！');
        });
    </script>

</body>
</html>

