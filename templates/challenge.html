<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathPro</title>
    <link rel="stylesheet" href="{{url_for('static',filename = 'css/challenge.css')}}">
    <script src="{{ url_for('static', filename='jquery/jquery.3.6.min.js') }}"></script>
</head>
<body>
    <div class="header">
        <div class="countdown" id="timer">作答用时：00:00</div>
        <div class="user-info">用户名</div>
    </div>
    <script>
        var timerElement = document.getElementById('timer');
        var timerSeconds = 0;
        var timerInterval;
        // 更新计时器显示
        function updateTimer() {
            var minutes = Math.floor(timerSeconds / 60);
            var seconds = timerSeconds % 60;
            var timeString = padZero(minutes) + ':' + padZero(seconds);
            timerElement.textContent = '作答用时：' + timeString;
            timerSeconds++;
        }
        // 添加前导零
        function padZero(num) {
            return (num < 10 ? '0' : '') + num;
        }
        // 页面加载时启动计时器
        window.onload = function() {
            timerInterval = setInterval(updateTimer, 1000);
        };
        // 点击提交按钮时，停止计时
        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        // 点击提交按钮时，显示用时时间
        function submitAnswers() {
            stopTimer();
            alert('作答用时：' + timerElement.textContent.split('：')[1]);
        }
        function pauseCountdown() {
            clearInterval(timerInterval);
            timerInterval = null; // 将计时器置为null，防止重复点击后产生多个计时器
        }

        // 点击继续计时按钮时，重新启动计时器
        function resumeCountdown() {
            if (!timerInterval) { // 如果计时器不存在，才重新启动计时器
                timerInterval = setInterval(updateTimer, 1000);
            }
        }
    </script>

    <div class="back-button" onclick="goBack()"></div>
    <script>
        function goBack() {
          window.history.back(); // JavaScript方法返回上一页
        }
    </script>
    <div class="content">
        <div class="question-area" id="questionArea">
            {% for question in test_questions %}
                {{ question.id }}
                <div class="knowledge-card">
                    <img src="{{ question.question_path }}" alt="题目图片">
                     <div class="question" id="question1">
                        <h3>题目{{ loop.index }}</h3>
                        <div class="titleview">
                            <input type="text" hidden="hidden" value = "{{ question.id }}">
                            <img src="{{ question.question_path }}" alt="题目图片">
                        </div>
                        <div class="submission-form">
                            <textarea class="text-input" id="text-answer-{{ question.id }}" placeholder="请输入选择题答案"></textarea>
                            <input type="file" class="file-input" id="file-upload-{{ question.id }}" accept="image/*">
                            <div class="image-preview" id="image-preview-{{ question.id }}"></div>
                        </div>

                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="question-number">
        <h2>作答详情</h2>
        <button class="time-button" onclick="pauseCountdown()">暂停计时</button>
        <button class="time-button" onclick="resumeCountdown()">继续计时</button>
        <ul class="question-list">
            <li class="selected" onclick="scrollToQuestion(1)">1</li>
            <li class="selected" onclick="scrollToQuestion(2)">2</li>
            <li class="selected" onclick="scrollToQuestion(3)">3</li>
            <li class="selected" onclick="scrollToQuestion(4)">4</li>
            <li class="selected" onclick="scrollToQuestion(5)">5</li>
            <li class="selected" onclick="scrollToQuestion(6)">6</li>
            <li class="selected" onclick="scrollToQuestion(7)">7</li>
            <li class="selected" onclick="scrollToQuestion(8)">8</li>
            <li class="selected" onclick="scrollToQuestion(9)">9</li>
            <li class="selected" onclick="scrollToQuestion(10)">10</li>
            <!-- 其他题目 -->
        </ul>

        <div class="action-buttons">
            <button onclick="saveAnswers()">保存</button>
            <button onclick="submitAnswers()">提交</button>
        </div>
    </div>
    </div>

<script>
        function submitAnswers(){
            alert('提交答案')
            var formData = new FormData();
            {%  for question in test_questions %}
            var textAnswer  = document.getElementById('text-answer-{{ question.id }}').value;
            var fileInput   = document.getElementById('file-upload-{{ question.id }}');
            if (fileInput.files.length>0){
                let file = fileInput.files[0];
                formData.append('file-{{ question.id }}', file);
            }
            formData.append('text-{{ question.id }}', textAnswer);
            {% endfor %}
        $.ajax({
            url: '/submit_answers_test',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                console.log('Success:', response);
                alert('答案提交成功');

                {#//window.location.href = '/titlescore?question_ids='+response.question_ids#}
                window.location.href = '/';

                },
            error: function(error) {
                    console.error('Error:', error);
                    alert('保存失败，请重试');
                }
        });

        }
</script>

<script>
        function saveAnswers(){
            alert('保存答案')
            var formData = new FormData();
            {%  for question in test_questions %}
            var textAnswer  = document.getElementById('text-answer-{{ question.id }}').value;
            var fileInput   = document.getElementById('file-upload-{{ question.id }}');
            if (fileInput.files.length>0){
                let file = fileInput.files[0];
                formData.append('file-{{ question.id }}', file);
            }
            formData.append('text-{{ question.id }}', textAnswer);
            {% endfor %}
        $.ajax({
            url: '/save_answers',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                console.log('Success:', response);
                alert('答案保存成功');
                },
            error: function(error) {
                    console.error('Error:', error);
                    alert('保存失败，请重试');
                }
        });

        }
    </script>
</body>
</html>




